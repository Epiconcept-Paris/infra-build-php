FROM debian:jessie
MAINTAINER Epiconcept

ENV DEBVER=jessie
ENV DEBNUM=8
ENV CLI_DEPS libjpeg62-turbo, libpng12-0, libxpm4, libmcrypt4, libxslt1.1, libcurl3, libfreetype6, libmysqlclient18, libxml2, libreadline6, libc6, libzip2
ENV BUILD_NUM=1
ENV USER=cedric
ENV LANG=C
ENV TZ=Europe/Paris
RUN groupadd -g 1000 cedric; useradd -u 1000 -g 1000 cedric
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ >/etc/timezone
RUN echo "export TERM=xterm\nalias l='ls -Al'\necho \"Use:\n    /opt/php-mk/build\\nto start the build\"" >>/root/.bashrc

# Update/upgrade, install tools and build deps
RUN apt-get update && apt-get upgrade -y && apt-get install -y --no-install-recommends vim apt-rdepends file curl build-essential autoconf pkg-config faketime fakeroot lintian apache2 apache2-dev libmcrypt-dev libmhash-dev libjpeg-dev libxpm-dev libxslt1-dev libbz2-dev libxft-dev libmysqlclient-dev libcurl4-openssl-dev libssl-dev libpcre3-dev libsystemd-dev libreadline-dev libssh2-1-dev libzip-dev

RUN mkdir -p /opt/php-mk/dist /opt/php-mk/files
RUN mkdir /opt/php-mk/hooks
COPY 7/files/apcu-5.1.20.tgz /opt/php-mk/files
COPY 7/hooks/apcu.sh /opt/php-mk/hooks
COPY 7/files/oauth-2.0.7.tgz /opt/php-mk/files
COPY 7/hooks/oauth.sh /opt/php-mk/hooks
COPY 7/files/mcrypt-1.0.4.tgz /opt/php-mk/files
COPY 7/hooks/mcrypt.sh /opt/php-mk/hooks
COPY 7/files/ssh2-1.3.1.tgz /opt/php-mk/files
COPY 7/hooks/ssh2.sh /opt/php-mk/hooks
COPY 7/files/ereg.tar.gz /opt/php-mk/files
COPY 7/hooks/ereg.sh /opt/php-mk/hooks
COPY 7/files/mysql.tar.gz /opt/php-mk/files
COPY 7/files/mysql.patch /opt/php-mk/files
COPY 7/hooks/mysql.sh /opt/php-mk/hooks
COPY files/PEAR_Manpages-1.10.0.tgz /opt/php-mk/files
COPY hooks/pearman.sh /opt/php-mk/hooks
COPY 7/7.3.27/php-7.3.27.tar.bz2 /opt/php-mk/files
COPY pkgs /opt/php-mk/pkgs
COPY run/build /opt/php-mk

CMD [ "/opt/php-mk/build" ]
